{
  "name": "Global Travel Report Daily Publisher",
  "description": "Automated daily content publishing workflow for Global Travel Report",
  "modules": [
    {
      "id": "schedule-trigger",
      "module": "schedule:watchEvents",
      "parameters": {
        "schedule": "0 0 * * *",
        "timezone": "Australia/Brisbane"
      },
      "metadata": {
        "designer": {
          "x": 100,
          "y": 100
        }
      }
    },
    {
      "id": "rss-parser",
      "module": "rss:retrieveFeedItems",
      "parameters": {
        "url": "https://globaltravelreport.com/rss/new",
        "limit": 8
      },
      "metadata": {
        "designer": {
          "x": 300,
          "y": 100
        }
      }
    },
    {
      "id": "story-iterator",
      "module": "iterator:iterateItems",
      "parameters": {
        "array": "{{rss-parser.items}}"
      },
      "metadata": {
        "designer": {
          "x": 500,
          "y": 100
        }
      }
    },
    {
      "id": "gemini-rewrite",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "x-goog-api-key": "{{GEMINI_API_KEY}}"
        },
        "body": {
          "contents": [
            {
              "parts": [
                {
                  "text": "Rewrite the following travel story in Australian English, in a professional tone, optimised for SEO and social media.\n\nProvide:\n- HEADLINE: [engaging, SEO-optimised title]\n- SUMMARY: [concise 150â€“200 word summary with key tips and details]\n\nMaintain all facts, locations, names, and relevance.\n\nOriginal Title: {{story-iterator.title}}\nOriginal Content: {{story-iterator.content}}"
                }
              ]
            }
          ],
          "generationConfig": {
            "temperature": 0.7,
            "maxOutputTokens": 1000
          }
        }
      },
      "metadata": {
        "designer": {
          "x": 700,
          "y": 100
        }
      }
    },
    {
      "id": "text-parser-headline",
      "module": "text:parseText",
      "parameters": {
        "text": "{{gemini-rewrite.response.body.candidates[0].content.parts[0].text}}",
        "pattern": "HEADLINE:\\s*(.+?)(?:\\n|$)",
        "globalMatch": false
      },
      "metadata": {
        "designer": {
          "x": 900,
          "y": 50
        }
      }
    },
    {
      "id": "text-parser-summary",
      "module": "text:parseText",
      "parameters": {
        "text": "{{gemini-rewrite.response.body.candidates[0].content.parts[0].text}}",
        "pattern": "SUMMARY:\\s*(.+?)(?:\\nHEADLINE:|$)",
        "globalMatch": false,
        "multiline": true
      },
      "metadata": {
        "designer": {
          "x": 900,
          "y": 150
        }
      }
    },
    {
      "id": "category-router",
      "module": "router:route",
      "parameters": {
        "routes": [
          {
            "name": "Cruise",
            "condition": "{{text-parser-headline.match}} contains 'cruise' OR {{text-parser-summary.match}} contains 'cruise'",
            "path": "cruise"
          },
          {
            "name": "Flight",
            "condition": "{{text-parser-headline.match}} contains 'flight' OR {{text-parser-headline.match}} contains 'airport' OR {{text-parser-headline.match}} contains 'airline' OR {{text-parser-summary.match}} contains 'flight' OR {{text-parser-summary.match}} contains 'airport' OR {{text-parser-summary.match}} contains 'airline'",
            "path": "flight"
          },
          {
            "name": "New Zealand",
            "condition": "{{text-parser-headline.match}} contains 'new zealand' OR {{text-parser-summary.match}} contains 'new zealand'",
            "path": "nz"
          },
          {
            "name": "Europe",
            "condition": "{{text-parser-headline.match}} contains 'europe' OR {{text-parser-headline.match}} contains 'france' OR {{text-parser-headline.match}} contains 'italy' OR {{text-parser-summary.match}} contains 'europe' OR {{text-parser-summary.match}} contains 'france' OR {{text-parser-summary.match}} contains 'italy'",
            "path": "europe"
          },
          {
            "name": "Travel News",
            "condition": "true",
            "path": "news"
          }
        ]
      },
      "metadata": {
        "designer": {
          "x": 1100,
          "y": 100
        }
      }
    },
    {
      "id": "unsplash-search",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://api.unsplash.com/search/photos",
        "method": "GET",
        "qs": {
          "query": "{{text-parser-headline.match}} {{substring(text-parser-summary.match, 0, 50)}}",
          "orientation": "landscape",
          "per_page": 1
        },
        "headers": {
          "Authorization": "Client-ID {{UNSPLASH_ACCESS_KEY}}"
        }
      },
      "metadata": {
        "designer": {
          "x": 1300,
          "y": 100
        }
      }
    },
    {
      "id": "website-publish",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://globaltravelreport.com/api/admin/ingest-content",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{ADMIN_TOKEN}}",
          "Content-Type": "application/json"
        },
        "body": {
          "title": "{{text-parser-headline.match}}",
          "content": "{{text-parser-summary.match}}",
          "imageUrl": "{{unsplash-search.response.body.results[0].urls.regular}}",
          "photographer": "{{unsplash-search.response.body.results[0].user.name}}",
          "category": "{{category-router.path}}",
          "tags": ["travel", "automated"],
          "publish": true
        }
      },
      "metadata": {
        "designer": {
          "x": 1500,
          "y": 50
        }
      }
    },
    {
      "id": "facebook-post",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://graph.facebook.com/v18.0/{{FACEBOOK_PAGE_ID}}/feed",
        "method": "POST",
        "qs": {
          "access_token": "{{FACEBOOK_ACCESS_TOKEN}}",
          "message": "{{text-parser-headline.match}}\n\n{{substring(text-parser-summary.match, 0, 200)}}...\n\n#GlobalTravelReport #Travel #{{category-router.path}}",
          "link": "{{story-iterator.link}}"
        }
      },
      "metadata": {
        "designer": {
          "x": 1500,
          "y": 150
        }
      }
    },
    {
      "id": "twitter-post",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://api.twitter.com/2/tweets",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{TWITTER_BEARER_TOKEN}}",
          "Content-Type": "application/json"
        },
        "body": {
          "text": "{{text-parser-headline.match}}\n\n{{substring(text-parser-summary.match, 0, 150)}}...\n\n#GlobalTravelReport #Travel #{{category-router.path}}\n\n{{story-iterator.link}}"
        }
      },
      "metadata": {
        "designer": {
          "x": 1500,
          "y": 250
        }
      }
    },
    {
      "id": "linkedin-post",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://api.linkedin.com/v2/ugcPosts",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{LINKEDIN_ACCESS_TOKEN}}",
          "Content-Type": "application/json",
          "X-Restli-Protocol-Version": "2.0.0"
        },
        "body": {
          "author": "urn:li:organization:{{LINKEDIN_ORG_ID}}",
          "lifecycleState": "PUBLISHED",
          "specificContent": {
            "com.linkedin.ugc.ShareContent": {
              "shareCommentary": {
                "text": "{{text-parser-headline.match}}\n\n{{substring(text-parser-summary.match, 0, 200)}}...\n\n#TravelIndustry #Tourism #{{category-router.path}}"
              },
              "shareMediaCategory": "NONE"
            }
          },
          "visibility": {
            "com.linkedin.ugc.MemberNetworkVisibility": "PUBLIC"
          }
        }
      },
      "metadata": {
        "designer": {
          "x": 1500,
          "y": 350
        }
      }
    },
    {
      "id": "rss-update",
      "module": "http:makeRequest",
      "parameters": {
        "url": "https://globaltravelreport.com/api/rss/update",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{ADMIN_TOKEN}}",
          "Content-Type": "application/json"
        },
        "body": {
          "title": "{{text-parser-headline.match}}",
          "description": "{{text-parser-summary.match}}",
          "link": "https://globaltravelreport.com/stories/{{slugify(text-parser-headline.match)}}",
          "image": "{{unsplash-search.response.body.results[0].urls.regular}}",
          "pubDate": "{{story-iterator.pubDate}}",
          "category": "{{category-router.path}}"
        }
      },
      "metadata": {
        "designer": {
          "x": 1700,
          "y": 100
        }
      }
    },
    {
      "id": "error-handler",
      "module": "error:errorHandler",
      "parameters": {
        "errorHandling": "continue"
      },
      "metadata": {
        "designer": {
          "x": 1900,
          "y": 100
        }
      }
    },
    {
      "id": "email-notification",
      "module": "email:sendEmail",
      "parameters": {
        "to": "admin@globaltravelreport.com",
        "subject": "Daily Automation Report - {{formatDate(schedule-trigger.timestamp, 'YYYY-MM-DD')}}",
        "html": "<h2>Daily Automation Complete</h2><p>Processed {{length(story-iterator.array)}} stories successfully.</p><p>Check logs for any errors.</p>"
      },
      "metadata": {
        "designer": {
          "x": 2100,
          "y": 100
        }
      }
    }
  ],
  "connections": [
    {
      "from": "schedule-trigger",
      "to": "rss-parser"
    },
    {
      "from": "rss-parser",
      "to": "story-iterator"
    },
    {
      "from": "story-iterator",
      "to": "gemini-rewrite"
    },
    {
      "from": "gemini-rewrite",
      "to": "text-parser-headline"
    },
    {
      "from": "gemini-rewrite",
      "to": "text-parser-summary"
    },
    {
      "from": "text-parser-headline",
      "to": "category-router"
    },
    {
      "from": "text-parser-summary",
      "to": "category-router"
    },
    {
      "from": "category-router",
      "to": "unsplash-search"
    },
    {
      "from": "unsplash-search",
      "to": "website-publish"
    },
    {
      "from": "unsplash-search",
      "to": "facebook-post"
    },
    {
      "from": "unsplash-search",
      "to": "twitter-post"
    },
    {
      "from": "unsplash-search",
      "to": "linkedin-post"
    },
    {
      "from": "unsplash-search",
      "to": "rss-update"
    },
    {
      "from": "rss-update",
      "to": "email-notification"
    }
  ],
  "variables": {
    "GEMINI_API_KEY": "",
    "UNSPLASH_ACCESS_KEY": "",
    "ADMIN_TOKEN": "",
    "FACEBOOK_ACCESS_TOKEN": "",
    "FACEBOOK_PAGE_ID": "",
    "TWITTER_BEARER_TOKEN": "",
    "LINKEDIN_ACCESS_TOKEN": "",
    "LINKEDIN_ORG_ID": ""
  }
}